# EvoSuite (un)common behavior test generation evaluation tool
This tool is designed for running an empirical evaluation for common and uncommon behavior test
generation using EvoSuite. It is designed to run in a UNIX environment. It is based on the [STAMP
tool it is forked from](https://github.com/STAMP-project/evosuite-model-seeding-empirical-evaluation).

## Required inputs
This tool needs the following inputs:

- **binary files:** the compiled packages of the software under test should be located in `bins/<project_name>`.
- **source files (optional):** source code of the software under test, should be located in `sources/<project_name>`.
- **classes.csv file:** This CSV file contains the list of the classes in the target projects that
we want to generate unit tests for. The first column of this CSV file is the name of the target
class, and the second one indicates the project name.
- **execution count file:** A file containing the execution counts for the software under test,
originating from preceding executions of the software (during production use, for example).

## Running the test generation
Execute the following command. Parameters are in angled brackets and are described below.
```
. main.sh <#rounds> <classes> <#processes limit> <search_budget> <exec_count_file>
```

- **#rounds:** Number of times tests should be generated for the same class using the same
configuration.
- **classes:** Path to the file containing classes for which tests should be generated, in the
format described above under *Required inputs*.
- **#processes limit:** The maximum number of EvoSuite processes that may be running at once.
Note that EvoSuite by default spawns two processes (master and client) for each execution.
- **search_budget:** The search budget to be used by EvoSuite
- **exec_count_file:** Path to the execution count file as described above under *Required inputs*.

## Output
With `/` being the root of this project:
- **`/evosuite-report/`**:
    - **`statistics.csv`**: The statistics file outputed by EvoSuite.
    - **`branch-coverage.csv`**: Branch coverage information for the generated tests, outputed by
    EvoSuite. The format is described below under *Branch coverage data*.
- **`/generated_tests/cub_test_gen/<configuration-name>/<project-name>-<class-name>-1-<iteration-number>`**:
    Contains all tests generated by EvoSuite. Configurations are described below under
    *Configurations*
- **`/logs/cub_test_gen/<configuration-name>/<project-name>-<class-name>-<iteration-number>-`**:
    - **`out`**: EvoSuite standard output log files
    - **`err`**: EvoSuite error log files

## Branch coverage data
The version of EvoSuite included in this repository outputs coverage data for all branches in
the software under test. It is saved in the `branch-coverage.csv` file mentioned under *Output*.
On each line, it contains the following information (variables in angled brackets):
```
<configuration>,<branch-line-numbers>,<#executions by generated tests>,<#executions in count file>
```
With the variables in the following format and meaning the following:
- **configuration**: `<class-name>-<configuration-name>-<iteration>` Configuration names are
described below under *Configurations*.
- **branch-line-numbers**: Line numbers of the branch in source code, in the format
    `<first line number>-<last line number>` (both inclusive).
- **#executions by generated tests**: Number of times the branch has been executed by the tests
generated by EvoSuite, over the whole suite generated by that EvoSuite execution.
- **#executions in count file**: Execution count for the branch as specified by the input execution
    count file.
    
## Configurations
EvoSuite is executed in the following configurations by this tool. They are listed by their names
as used in the folder structure for output files. In short, EvoSuite is executed using MOSA and
NSGA-II. For MOSA, it is executed using different combinations of fitness functions and secondary
objectives. For NSGA-II, it is executed using both the minimum and maximum execution count fitness
functions.

- **fit_def_sec_def**: MOSA using the EvoSuite default fitness functions and secondary objectives.
- **fit_def_sec_max**: MOSA using the EvoSuite default fitness functions and maximum execution count
    secondary objective.
- **fit_def_sec_min**: MOSA using the EvoSuite default fitness functions and minimum execution count
    secondary objective.
- **fit_max_min_sec_def**: MOSA using the minimum and maximum execution count fitness functions, and
    the EvoSuite default secondary objective.
- **fit_max_sec_max**: MOSA using the maximum execution count fitness function and secondary
    objective.
- **fit_min_sec_min**: MOSA using the minimum execution count fitness function and secondary
   objective.
- **nsgaii_max**: NSGA-II using the maximum execution count fitness function and secondary objective.
- **nsgaii_min**: NSGA-II using the minimum execution count fitness function and secondary objective.

## Run PIT on the generated tests

After generating tests, you just need to run `run_pitest.sh` file in the root directory.
This script, first, finds all of the existing generated test cases.
Then, it removes all of the flaky tests from the generated tests (it runs each of the test cases
5 times. If any test fails even one time, it will be ignored). Finally, it applies PIT on the
existing test cases. 

The PIT report is saved in the following directory:
```
pitest/out/cub_test_gen/<project_name>-<target_class>-<clone_seed_probability>-<id_of_round>
```

# Licenses
This repository contains the following software under the following licenses. The full licenses are
included under the `/dependency-licenses/` folder
- *EvoSuite*: A (modified) EvoSuite binary is included. EvoSuite is distributed under the GNU LGPLv3.
    The modified version of EvoSuite that is used can be found in
    [this GitHub repository](https://github.com/STAMP-project/evosuite-ramp/tree/cub-test-gen).
- *JabRef*: A (modified) JabRef binary and (modified) source code is included. JabRef is distributed
    under the MIT license.
